<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sure Odds Uganda</title>

<!-- Styles -->
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b0f1a;color:white;}
header{background:#111827;padding:18px;font-size:24px;font-weight:bold;text-align:center;position:relative;}
.menu{position:absolute;left:15px;top:15px;font-size:22px;cursor:pointer;}
.dropdown{display:none;position:absolute;left:10px;top:50px;background:#020617;padding:10px;border-radius:10px;z-index:10;}
.dropdown button{background:none;color:white;border:none;font-size:16px;cursor:pointer;}
nav{display:flex;justify-content:center;gap:20px;background:#020617;padding:12px;}
nav a{color:#38bdf8;text-decoration:none;font-weight:bold;cursor:pointer;}
.container{max-width:900px;margin:auto;padding:20px;}
.section{margin-bottom:25px;padding:20px;border-radius:12px;box-shadow:0 0 10px #000;}
.free{background:#020617;}
.vip{background:linear-gradient(135deg,gold,orange);color:black;}
button{padding:12px 18px;border:none;border-radius:8px;background:#22c55e;color:white;font-size:16px;cursor:pointer;margin-top:10px;transition:0.3s;}
button:hover{background:#16a34a;transform:scale(1.05);}
input,textarea,select{padding:10px;border-radius:6px;border:none;margin-top:10px;width:95%;}
.page{display:none;}.active{display:block;}
.whatsapp{position:fixed;bottom:20px;right:20px;background:#25D366;padding:15px;border-radius:50%;font-size:20px;text-decoration:none;color:white;}
p.notice{color:yellow;font-weight:bold;}
.date{position:absolute;top:15px;right:20px;font-size:14px;color:#d1d5db;}
.comment-section{margin-top:15px;}
.comment{background:#111827;padding:8px;border-radius:8px;margin-bottom:8px;}
.download{position:fixed;top:20px;right:20px;font-size:24px;color:#38bdf8;cursor:pointer;}
.score-badge{background:#1e293b;padding:10px;border-radius:8px;margin-bottom:15px;font-size:18px;border-left:4px solid gold;}
.score-badge span{color:gold;font-weight:bold;}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>

</head>
<body>

<header>
<div class="menu" onclick="toggleMenu()">‚ãÆ</div>
Sure Odds Uganda
<div class="date" id="todayDate"></div>
<div class="dropdown" id="menuBox">
  <button onclick="showPage('admin')">Admin</button>
</div>
</header>

<!-- Download Icon -->
<div class="download" onclick="window.location.href='https://drive.google.com/file/d/1uO45XwoXhs5SWV0jqD89stOHAoIuzIsL/view?usp=drivesdk'">‚¨áÔ∏è</div>

<nav>
  <a onclick="showPage('home')">Home</a>
  <a onclick="showPage('free')">Free Tips</a>
  <a onclick="showPage('vip')">VIP</a>
  <a onclick="showPage('login')">VIP Login</a>
</nav>

<div class="container">

<!-- HOME -->
<div id="home" class="page active">
  <!-- Correct Score Display -->
  <div class="section free" id="homeScoreDisplay" style="display:none;">
    <h2>‚öΩ Today's Correct Score</h2>
    <div id="homeScoreList"></div>
  </div>
  <div class="section free">
    <h2>üî• Free Odds</h2>
    <ul id="freeList"></ul>
    <button onclick="openBet('free')">Get Free Tips on BetPawa</button>
    <div class="comment-section" id="freeComments"></div>
    <input id="freeCommentInput" placeholder="Add comment">
    <button onclick="addComment('free')">Comment</button>
  </div>
  <div class="section vip">
    <h2>üëë VIP Odds 10</h2>
    <p>Weekly: 15,000 UGX</p>
    <p><b>Send MTN Mobile Money to:</b><br>+256703907682</p>
    <p class="notice">‚ö†Ô∏è After sending money, please send a screenshot on WhatsApp to get your VIP login.</p>
    <p>Follow my TikTok: <a href="https://www.tiktok.com/@ugandan.agent.23?_r=1&_t=ZS-940Y9UzoLCP" target="_blank" style="color:#38bdf8;">@ugandan.agent.23</a></p>
  </div>
</div>

<!-- FREE PAGE -->
<div id="free" class="page">
  <!-- Correct Score Display -->
  <div class="section free" id="freeScoreDisplay" style="display:none;">
    <h2>‚öΩ Today's Correct Score</h2>
    <div id="freeScoreList"></div>
  </div>
  <div class="section free">
    <h2>üìÖ Today Free Tips</h2>
    <ul id="freeList2"></ul>
    <button onclick="openBet('free')">Get Free Tips on BetPawa</button>
    <div class="comment-section" id="freeComments2"></div>
    <input id="freeCommentInput2" placeholder="Add comment">
    <button onclick="addComment('free2')">Comment</button>
  </div>
</div>

<!-- VIP PAGE -->
<div id="vip" class="page">
  <div id="vipLocked" class="section vip">
    <h2>üîí VIP Only</h2>
    <p>Login after payment. Expiry counts down automatically.</p>
    <p class="notice">‚ö†Ô∏è After sending money, send a screenshot on WhatsApp to get VIP login.</p>
    <button onclick="showPage('login')">VIP Login</button>
  </div>
  <div id="vipContent" class="section free" style="display:none;">
    <h2>üëë VIP Odds</h2>
    <ul id="vipList"></ul>
    <button onclick="openBet('vip')">VIP BetPawa Link</button>
    <p id="vipTimer"></p>
    <div class="comment-section" id="vipComments"></div>
    <input id="vipCommentInput" placeholder="Add comment">
    <button onclick="addComment('vip')">Comment</button>
  </div>
</div>

<!-- VIP LOGIN -->
<div id="login" class="page">
  <div class="section free">
    <h2>VIP Login</h2>
    <input id="vipUser" placeholder="Username">
    <input id="vipPass" type="password" placeholder="Password">
    <button onclick="vipLogin()">Login</button>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="admin" class="page">
  <div class="section free">
    <h2>Admin Panel</h2>
    <input id="adminPass" type="password" placeholder="Admin password">
    <button onclick="unlockAdmin()">Enter</button>
    <div id="adminArea" style="display:none;">
      <h3>Create VIP User</h3>
      <input id="newUser" placeholder="Username">
      <input id="newPass" placeholder="Password">
      <select id="vipExpiry">
        <option value="weekly">Weekly VIP (7d)</option>
      </select>
      <button onclick="createVIP()">Create VIP</button>

      <h3>Edit Free Tips</h3>
      <textarea id="adminFree" rows="4"></textarea>

      <h3>Edit VIP Tips</h3>
      <textarea id="adminVIP" rows="4"></textarea>

      <h3>BetPawa Links</h3>
      <input id="freeBetLink" placeholder="Free BetPawa link">
      <input id="vipBetLink" placeholder="VIP BetPawa link">

      <!-- NEW: Correct Scores Section -->
      <h3>‚öΩ Correct Scores (one per line)</h3>
      <textarea id="adminScores" rows="3" placeholder="e.g. Arsenal 2-1 Chelsea&#10;Liverpool 3-0 Man City"></textarea>

      <!-- NEW: Push Notification Section -->
      <h3>üì≤ Send Push Notification to All Users</h3>
      <input id="notifTitle" placeholder="Notification Title (e.g. New Tips)">
      <textarea id="notifBody" rows="2" placeholder="Notification message..."></textarea>
      <button onclick="queueNotification()">Send to All Users</button>
      <p style="color:orange; font-size:0.9em;">Note: For actual delivery, you need a Firebase Cloud Function. See instructions below.</p>

      <button onclick="saveAll()">Save All Changes</button>
    </div>
  </div>
</div>

</div>

<a class="whatsapp" href="https://wa.me/256703907682">üí¨</a>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyA2sHcxmcdXd_r-28VsxU8Nqs_t6s7LBDI",
  authDomain: "sure-odds-uganda.firebaseapp.com",
  databaseURL: "https://sure-odds-uganda-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sure-odds-uganda",
  storageBucket: "sure-odds-uganda.appspot.com",
  messagingSenderId: "26839342156",
  appId: "1:26839342156:web:e3ea35b88ba31d366528e9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const messaging = firebase.messaging();

// Date
document.getElementById('todayDate').innerText = new Date().toDateString();

// Show page
function showPage(id){document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));document.getElementById(id).classList.add("active");}

// Toggle menu
function toggleMenu(){const menuBox=document.getElementById('menuBox');menuBox.style.display = menuBox.style.display==="block"?"none":"block";}

// Open BetPawa
function openBet(type){
  if(type==="vip") db.ref('links/vip').once('value',snap=>window.open(snap.val()||"#","_blank"));
  else db.ref('links/free').once('value',snap=>window.open(snap.val()||"#","_blank"));
}

// Load tips
db.ref('tips/free').on('value',snap=>{
  let data = snap.val()||["No Free Tips"];
  freeList.innerHTML = data.map(x=>`<li>${x}</li>`).join("");
  freeList2.innerHTML = data.map(x=>`<li>${x}</li>`).join("");
});
db.ref('tips/vip').on('value',snap=>{
  let data = snap.val()||["No VIP Tips"];
  vipList.innerHTML = data.map(x=>`<li>${x}</li>`).join("");
});

// Load and display Correct Scores
function displayScores() {
  db.ref('scores/today').on('value', snap => {
    let scores = snap.val() || [];
    if (!Array.isArray(scores)) scores = [scores]; // ensure array
    let html = scores.map(s => `<div class="score-badge"><span>‚öΩ</span> ${s}</div>`).join('');
    if (html) {
      document.getElementById('homeScoreList').innerHTML = html;
      document.getElementById('freeScoreList').innerHTML = html;
      document.getElementById('homeScoreDisplay').style.display = 'block';
      document.getElementById('freeScoreDisplay').style.display = 'block';
    } else {
      document.getElementById('homeScoreDisplay').style.display = 'none';
      document.getElementById('freeScoreDisplay').style.display = 'none';
    }
  });
}
displayScores();

// VIP login
let vipTimerInterval;
function vipLogin(){
  let u = vipUser.value;
  let p = vipPass.value;
  db.ref("vip/"+u).once("value").then(snap=>{
    if(!snap.exists()) return alert("VIP not found");
    const data = snap.val();
    if(data.pass!==p) return alert("Wrong password");
    if(Date.now()>data.expiry) return alert("VIP expired");
    vipLocked.style.display="none";
    vipContent.style.display="block";
    clearInterval(vipTimerInterval);
    vipTimerInterval=setInterval(()=>{
      let t = data.expiry-Date.now();
      if(t<=0){ location.reload(); return; }
      vipTimer.innerText="VIP expires in "+Math.floor(t/60000)+" min";
    },1000);
  });
}

// Admin
function unlockAdmin(){
  if(adminPass.value==="1234"){
    adminArea.style.display="block";
    db.ref('tips/free').once('value').then(snap=>adminFree.value=(snap.val()||[]).join("\n"));
    db.ref('tips/vip').once('value').then(snap=>adminVIP.value=(snap.val()||[]).join("\n"));
    db.ref('links/free').once('value').then(snap=>freeBetLink.value=snap.val()||"");
    db.ref('links/vip').once('value').then(snap=>vipBetLink.value=snap.val()||"");
    db.ref('scores/today').once('value').then(snap=>{
      let scores = snap.val() || [];
      adminScores.value = Array.isArray(scores) ? scores.join("\n") : scores;
    });
  }else alert("Wrong password");
}

// Create VIP
function createVIP(){
  let expiry = vipExpiry.value==="weekly"?Date.now()+7*24*60*60*1000:Date.now()+24*60*60*1000;
  db.ref("vip/"+newUser.value).set({pass:newPass.value,expiry:expiry});
  alert("VIP Created");
}

// Queue push notification (writes to database for cloud function to pick up)
function queueNotification() {
  let title = notifTitle.value.trim();
  let body = notifBody.value.trim();
  if (!title || !body) return alert("Please enter both title and message");
  db.ref('notifications/outbox').push({
    title: title,
    body: body,
    timestamp: Date.now()
  }).then(() => {
    alert("Notification queued! It will be sent within a few seconds if your cloud function is active.");
    notifTitle.value = '';
    notifBody.value = '';
  }).catch(err => alert("Error: " + err));
}

// Save all admin data (including scores)
function saveAll(){
  db.ref('tips/free').set(adminFree.value.split("\n").filter(line => line.trim() !== ""));
  db.ref('tips/vip').set(adminVIP.value.split("\n").filter(line => line.trim() !== ""));
  db.ref('links/free').set(freeBetLink.value);
  db.ref('links/vip').set(vipBetLink.value);
  // Save scores as array
  let scores = adminScores.value.split("\n").filter(line => line.trim() !== "");
  db.ref('scores/today').set(scores);
  alert("Saved! Everyone sees updates instantly.");
}

// Comments (auto-delete 2 days)
function addComment(section){
  let input,id;
  if(section==="free"){input=freeCommentInput;id='comments/free';}
  else if(section==="free2"){input=freeCommentInput2;id='comments/free2';}
  else{input=vipCommentInput;id='comments/vip';}
  if(!input.value) return;
  const comment={text:input.value,time:Date.now()};
  db.ref(id).push(comment);
  input.value="";
}
function loadComments(){
  ['free','free2','vip'].forEach(sec=>{
    const container=document.getElementById(sec==='vip'?'vipComments':sec==='free'?'freeComments':'freeComments2');
    db.ref('comments/'+sec).on('value',snap=>{
      container.innerHTML='';
      snap.forEach(child=>{
        const data=child.val();
        if(Date.now()-data.time>2*24*60*60*1000){child.ref.remove();}
        else container.innerHTML+=`<div class="comment">${data.text}</div>`;
      });
    });
  });
}
loadComments();

// Push notifications setup (browser permission and token storage)
messaging.requestPermission()
.then(()=>messaging.getToken({vapidKey:"BE9t9sEWU-8X-2KUiUecmylIpQP2VRkRF3Ej8B2TWmGlnJ3tMCSFHkBpf0o3dYBS1oiZ61hUHLzaBxi1u8EE0Yc"}))
.then(token=>{
  console.log("FCM Token:",token);
  db.ref('fcmTokens/'+token).set(true);
})
.catch(err=>console.log("FCM Permission Denied",err));

// Listen for incoming push messages while site is open (optional)
messaging.onMessage((payload) => {
  console.log("Message received while open:", payload);
  alert(payload.notification.title + "\n" + payload.notification.body);
});

</script>

<!-- Instructions for Cloud Function (hidden, but you can read them) -->
<div style="display:none;">
  <h3>Firebase Cloud Function for Push Notifications</h3>
  <pre>
// Place this in your Firebase Cloud Functions (index.js)
const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp();

exports.sendPushNotifications = functions.database
  .ref('/notifications/outbox/{pushId}')
  .onCreate(async (snapshot, context) => {
    const { title, body } = snapshot.val();
    // Get all FCM tokens
    const tokensSnap = await admin.database().ref('fcmTokens').once('value');
    const tokens = tokensSnap.val() ? Object.keys(tokensSnap.val()) : [];
    if (tokens.length === 0) return null;

    const payload = {
      notification: { title, body, click_action: 'https://yourapp.com' }
    };

    // Send to all tokens
    const response = await admin.messaging().sendMulticast({ ...payload, tokens });
    // Cleanup invalid tokens
    if (response.failureCount > 0) {
      response.responses.forEach((resp, idx) => {
        if (!resp.success) {
          admin.database().ref('fcmTokens').child(tokens[idx]).remove();
        }
      });
    }
    // Remove the notification request from outbox
    return snapshot.ref.remove();
  });
  </pre>
  <p>Deploy with: <code>firebase deploy --only functions</code></p>
</div>
</body>
                           </html>
